<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE LENG - Çoklu Video Yönetim Platformu</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    :root {
      --font-size-multiplier: 1;
      --bg-primary: #f8f9fa;
      --bg-secondary: #e9ecef;
      --bg-tertiary: #dee2e6;
      --bg-secondary-rgb: 233, 236, 239;
      --text-primary: #495057;
      --text-secondary: #6c757d;
      --text-muted: #adb5bd;
      --border-color: #dee2e6;
      --accent-light: #495057;
      --accent-dark: #f8f9fa;
      --shadow-light: rgba(73, 80, 87, 0.1);
      --shadow-dark: rgba(73, 80, 87, 0.15);
      --gradient-primary: linear-gradient(135deg, #495057, #6c757d);
      --gradient-secondary: linear-gradient(135deg, #e9ecef, #dee2e6);
      --primary-color: #495057;
      --secondary-color: #6c757d;
      --accent-color: #adb5bd;
      --header-height: 80px;
      --navbar-bg: rgba(248, 249, 250, 0.95);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Rubik', 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      position: relative;
      overflow: hidden;
      font-size: calc(16px * var(--font-size-multiplier));
      line-height: 1.6;
      transition: all 0.3s ease;
    }

    /* Animated Wave Background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
      background-size: 400% 400%;
      animation: waveAnimation 15s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes waveAnimation {
      0%, 100% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
    }

    /* Header - Only visible when panels are open */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: transparent;
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      z-index: 1000;
      height: var(--header-height);
      transform: translateY(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header.visible {
      transform: translateY(0);
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: rgba(var(--bg-secondary-rgb), 0.9);
      backdrop-filter: blur(20px);
      padding: 1rem 2rem;
      border-radius: 20px;
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 32px var(--shadow-light);
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-image {
      width: 40px;
      height: 40px;
      object-fit: contain;
      border-radius: 8px;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
    }

    .logo-text:hover {
      transform: scale(1.05);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(var(--bg-primary), 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary-color);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    /* Toggle Buttons */
    .toggle-buttons {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      display: flex;
      gap: 0.5rem;
    }

    .toggle-btn {
      background: rgba(var(--bg-secondary-rgb), 0.95);
      backdrop-filter: blur(20px);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 32px var(--shadow-light);
    }

    .toggle-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 12px 40px var(--shadow-dark);
      background: var(--bg-tertiary);
    }

    .settings-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1001;
    }

    /* Panels */
    #sidebar, #settings {
      width: 380px;
      background: rgba(var(--bg-secondary-rgb), 0.95);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--border-color);
      overflow: hidden;
      transform: translateX(-100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: fixed;
      top: 0;
      bottom: 0;
      z-index: 999;
      box-shadow: 0 0 50px var(--shadow-light);
      display: flex;
      flex-direction: column;
    }

    #settings {
      transform: translateX(100%);
      right: 0;
      left: auto;
      border-right: none;
      border-left: 1px solid var(--border-color);
    }

    #sidebar.active, #settings.active {
      transform: translateX(0);
    }

    .panel-header {
      padding: 2rem 2rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      background: rgba(var(--bg-primary), 0.5);
      backdrop-filter: blur(10px);
      flex-shrink: 0;
    }

    .panel-title {
      font-size: 1.25rem;
      font-weight: 600;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .panel-content {
      padding: 2rem;
      overflow-y: auto;
      flex: 1;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .panel-content::-webkit-scrollbar {
      display: none;
    }

    /* Main Content */
    #main {
      width: 100vw;
      height: 100vh;
      display: grid;
      gap: 1px;
      background: var(--border-color);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #main.sidebar-shifted {
      margin-left: 380px;
      width: calc(100vw - 380px);
    }

    #main.settings-shifted {
      margin-right: 380px;
      width: calc(100vw - 380px);
    }

    #main.both-shifted {
      margin-left: 380px;
      margin-right: 380px;
      width: calc(100vw - 760px);
    }

    #main.header-visible {
      margin-top: var(--header-height);
      height: calc(100vh - var(--header-height));
    }

    /* Empty State */
    .empty-state {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      background: rgba(var(--bg-secondary-rgb), 0.9);
      backdrop-filter: blur(20px);
      padding: 3rem;
      border-radius: 24px;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 60px var(--shadow-light);
      max-width: 500px;
      width: 90%;
    }

    .empty-state h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    .empty-state p {
      color: var(--text-secondary);
      margin-bottom: 2rem;
      font-size: 1rem;
    }

    .empty-state-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .empty-state input {
      padding: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      background: rgba(var(--bg-primary), 0.8);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .empty-state input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(73, 80, 87, 0.1);
    }

    /* Grid Layouts */
    #main.video-count-1 { grid-template-columns: 1fr; }
    #main.video-count-2 { grid-template-columns: repeat(2, 1fr); }
    #main.video-count-3 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
    #main.video-count-4 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
    #main.video-count-5,
    #main.video-count-6,
    #main.video-count-7,
    #main.video-count-8,
    #main.video-count-9 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); }

    #main.video-count-3 iframe:nth-child(3) { grid-column: span 2; }
    
    /* Template Layouts */
    #main.layout-1x2 { grid-template-columns: repeat(2, 1fr); }
    #main.layout-2x2 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
    #main.layout-2x3 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); }
    
    /* Picture-in-Picture Layout */
    #main.layout-pip {
      grid-template-columns: 2fr 1fr;
      grid-template-rows: 2fr 1fr 1fr;
    }
    
    #main.layout-pip .video-container:first-child {
      grid-column: 1;
      grid-row: 1 / 4;
    }
    
    /* Focus Layout - One big, others small */
    #main.layout-focus {
      grid-template-columns: 3fr 1fr 1fr;
      grid-template-rows: 2fr 1fr 1fr;
    }
    
    #main.layout-focus .video-container:first-child {
      grid-column: 1;
      grid-row: 1 / 4;
    }
    
    /* Sidebar Layout */
    #main.layout-sidebar {
      grid-template-columns: 2fr 1fr;
      grid-template-rows: repeat(4, 1fr);
    }
    
    #main.layout-sidebar .video-container:first-child {
      grid-column: 1;
      grid-row: 1 / 5;
    }

    /* Video Container */
    .video-container {
      position: relative;
      background: var(--bg-primary);
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .video-container:hover {
      box-shadow: inset 0 0 0 2px var(--primary-color);
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      transition: opacity 0.3s ease;
      opacity: 0;
    }

    iframe.loaded {
      opacity: 1;
    }

    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, rgba(73,80,87,0.7) 0%, transparent 30%, transparent 70%, rgba(73,80,87,0.7) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 1rem;
    }

    .video-container:hover .video-overlay {
      opacity: 1;
    }

    .video-controls {
      display: flex;
      gap: 0.5rem;
      align-self: flex-end;
      pointer-events: all;
    }

    .video-info {
      color: white;
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 2rem;
    }

    .form-group.featured {
      background: rgba(var(--bg-primary), 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid var(--primary-color);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px var(--shadow-light);
    }

    .form-label {
      display: block;
      margin-bottom: 1rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-label.featured {
      font-size: 1.1rem;
      color: var(--primary-color);
    }

    input, select {
      width: 100%;
      padding: 1rem;
      background: rgba(var(--bg-primary), 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: all 0.3s ease;
    }

    .form-group.featured input {
      padding: 1.25rem;
      font-size: 1rem;
      border: 2px solid var(--border-color);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(73, 80, 87, 0.1);
      transform: translateY(-1px);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--accent-dark);
      border: 1px solid var(--border-color);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow-dark);
    }

    .btn-secondary {
      background: rgba(var(--bg-tertiary), 0.8);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
    }

    .btn-success {
      background: linear-gradient(135deg, #6c757d, #495057);
      color: white;
      border: 1px solid var(--border-color);
    }

    .btn-warning {
      background: linear-gradient(135deg, #adb5bd, #6c757d);
      color: white;
      border: 1px solid var(--border-color);
    }

    .btn-danger {
      background: linear-gradient(135deg, #6c757d, #495057);
      color: white;
      border: 1px solid var(--border-color);
    }

    .btn-sm {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }

    /* Statistics */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: rgba(var(--bg-primary), 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow-dark);
    }

    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Video List */
    .video-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem;
      margin-bottom: 1rem;
      background: rgba(var(--bg-primary), 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      cursor: move;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .video-item:hover {
      border-color: var(--primary-color);
      transform: translateX(4px) translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow-dark);
    }

    .video-item.dragging {
      opacity: 0.5;
      transform: rotate(5deg) scale(0.95);
    }

    .video-thumbnail {
      width: 70px;
      height: 50px;
      object-fit: cover;
      border-radius: 8px;
      flex-shrink: 0;
    }

    .video-details {
      flex: 1;
      min-width: 0;
    }

    .video-title {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .video-duration {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Platform Indicator */
    .platform-indicator {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: rgba(73, 80, 87, 0.8);
      color: white;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
      z-index: 10;
    }

    .platform-youtube { background: rgba(108, 117, 125, 0.8); }
    .platform-kick { background: rgba(173, 181, 189, 0.8); }

    /* Template Selection */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .template-card {
      background: rgba(var(--bg-primary), 0.8);
      backdrop-filter: blur(10px);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .template-card:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow-dark);
    }

    .template-card.active {
      border-color: var(--primary-color);
      background: rgba(var(--primary-color), 0.1);
    }

    .template-preview {
      width: 100%;
      height: 60px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 0.5rem;
      position: relative;
      overflow: hidden;
    }

    .template-preview::before {
      content: '';
      position: absolute;
      background: var(--primary-color);
      border-radius: 2px;
    }

    /* Template previews */
    .template-card[data-layout="auto"] .template-preview::before {
      width: 80%;
      height: 80%;
      top: 10%;
      left: 10%;
    }

    .template-card[data-layout="focus"] .template-preview::before {
      width: 60%;
      height: 80%;
      top: 10%;
      left: 5%;
      box-shadow: 15px 0 0 var(--accent-color), 15px 15px 0 var(--accent-color), 15px 30px 0 var(--accent-color);
    }

    .template-card[data-layout="pip"] .template-preview::before {
      width: 70%;
      height: 80%;
      top: 10%;
      left: 5%;
      box-shadow: 20px 0 0 var(--accent-color), 20px 15px 0 var(--accent-color);
    }

    .template-card[data-layout="sidebar"] .template-preview::before {
      width: 60%;
      height: 80%;
      top: 10%;
      left: 5%;
      box-shadow: 20px 0 0 var(--accent-color), 20px 10px 0 var(--accent-color), 20px 20px 0 var(--accent-color), 20px 30px 0 var(--accent-color);
    }

    .template-name {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Unified Margin Control */
    .margin-control {
      background: rgba(var(--bg-primary), 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .margin-control-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .margin-control-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .margin-slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--bg-tertiary);
      outline: none;
      -webkit-appearance: none;
      margin: 1rem 0;
    }

    .margin-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .margin-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .margin-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .margin-value {
      text-align: center;
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }

    /* Notifications */
    .notification {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      padding: 1rem 1.5rem;
      background: rgba(var(--bg-secondary-rgb), 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: 0 8px 32px var(--shadow-light);
      max-width: 400px;
      z-index: 1002;
      animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1), slideOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) 4s forwards;
    }

    .notification.success {
      border-color: var(--primary-color);
      background: rgba(var(--primary-color), 0.1);
    }

    .notification.error {
      border-color: var(--text-muted);
      background: rgba(var(--text-muted), 0.1);
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOutRight {
      to { transform: translateX(100%); opacity: 0; }
    }

    /* Fullscreen styles */
    .fullscreen-active {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999 !important;
      background: var(--bg-primary) !important;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      #sidebar, #settings {
        width: 100%;
      }

      #main.sidebar-shifted, #main.settings-shifted, #main.both-shifted {
        margin-left: 0;
        margin-right: 0;
        width: 100vw;
        display: none;
      }

      #main {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(auto-fit, minmax(200px, 1fr)) !important;
      }

      .toggle-btn {
        width: 44px;
        height: 44px;
        font-size: 1.1rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .toggle-buttons {
        flex-direction: column;
      }

      .template-grid {
        grid-template-columns: 1fr;
      }

      .empty-state {
        padding: 2rem;
        margin: 1rem;
      }
    }

    /* Smooth transitions for all elements */
    * {
      transition: background-color 0.3s ease, 
                  border-color 0.3s ease, 
                  color 0.3s ease,
                  transform 0.3s ease;
    }
  </style>
</head>
<body>
  <!-- Logo placeholder -->
  <img src="logo3.PNG" alt="Logo" style="display: none;" id="logoImage" />

  <!-- Header - Only visible when panels are open -->
  <header class="header" id="header">
    <div class="header-content">
      <div class="logo-container">
        <img src="logo3.PNG" alt="THE LENG Logo" class="logo-image" />
        <div class="logo-text">THE LENG</div>
      </div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span id="videoCount">0 Video</span>
      </div>
    </div>
  </header>

  <!-- Toggle Buttons -->
  <div class="toggle-buttons">
    <button id="toggleSidebar" class="toggle-btn" aria-label="Video listesi menüsünü aç/kapat">
      <i class="fas fa-list"></i>
    </button>
    <button id="toggleFullscreen" class="toggle-btn" aria-label="Tam ekran">
      <i class="fas fa-expand"></i>
    </button>
    <button id="openPopup" class="toggle-btn" aria-label="Popup pencerede aç">
      <i class="fas fa-external-link-alt"></i>
    </button>
  </div>

  <button id="toggleSettings" class="toggle-btn settings-toggle" aria-label="Ayarlar menüsünü aç/kapat">
    <i class="fas fa-cog"></i>
  </button>

  <!-- Sidebar -->
  <div id="sidebar">
    <div class="panel-header">
      <h3 class="panel-title">
        <i class="fas fa-video"></i>
        Video Yönetimi
      </h3>
    </div>
    <div class="panel-content">
      <!-- Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalVideos">0</div>
          <div class="stat-label">Toplam</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="playingVideos">0</div>
          <div class="stat-label">Oynatılıyor</div>
        </div>
      </div>

      <!-- Featured Add Video Form -->
      <div class="form-group featured">
        <label class="form-label featured" for="videoUrl">
          <i class="fas fa-plus-circle"></i>
          Video/Yayın Ekle
        </label>
        <input type="text" id="videoUrl" placeholder="YouTube: https://www.youtube.com/watch?v=... veya Kick: https://kick.com/..." />
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.75rem; text-align: center;">
          YouTube ve Kick platformları destekleniyor
        </div>
        <button class="btn btn-primary" onclick="debouncedAddVideo()" style="width: 100%; margin-top: 1rem; padding: 1.25rem;">
          <i class="fas fa-plus"></i>
          Video/Yayın Ekle
        </button>
      </div>

      <!-- Control Buttons -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
        <button class="btn btn-success" onclick="playAll()">
          <i class="fas fa-play"></i>
          Tümünü Oynat
        </button>
        <button class="btn btn-warning" onclick="pauseAll()">
          <i class="fas fa-pause"></i>
          Tümünü Duraklat
        </button>
      </div>

      <!-- Template Selection -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-th-large"></i>
          Düzen Şablonları
        </label>
        <div class="template-grid">
          <div class="template-card active" data-layout="auto" onclick="selectTemplate('auto')">
            <div class="template-preview"></div>
            <div class="template-name">Otomatik</div>
          </div>
          <div class="template-card" data-layout="focus" onclick="selectTemplate('focus')">
            <div class="template-preview"></div>
            <div class="template-name">Ana Odak</div>
          </div>
          <div class="template-card" data-layout="pip" onclick="selectTemplate('pip')">
            <div class="template-preview"></div>
            <div class="template-name">PiP Modu</div>
          </div>
          <div class="template-card" data-layout="sidebar" onclick="selectTemplate('sidebar')">
            <div class="template-preview"></div>
            <div class="template-name">Kenar Çubuğu</div>
          </div>
        </div>
      </div>

      <!-- Video List -->
      <div style="border-top: 1px solid var(--border-color); padding-top: 2rem;">
        <h4 style="margin-bottom: 1.5rem; color: var(--text-secondary); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;">
          <i class="fas fa-list-ul"></i>
          Video/Yayın Listesi
        </h4>
        <div id="videoList"></div>
      </div>
    </div>
  </div>

  <!-- Settings Panel -->
  <div id="settings">
    <div class="panel-header">
      <h3 class="panel-title">
        <i class="fas fa-sliders-h"></i>
        Ayarlar
      </h3>
    </div>
    <div class="panel-content">
      <!-- Unified Margin Control -->
      <div class="margin-control">
        <div class="margin-control-header">
          <i class="fas fa-expand-arrows-alt"></i>
          <span class="margin-control-title">Kenar Boşlukları</span>
        </div>
        <input type="range" id="marginSlider" class="margin-slider" min="0" max="100" value="0" />
        <div class="margin-value">
          <span id="marginValue">0px</span> - Tüm kenarlar
        </div>
        <div style="font-size: 0.75rem; color: var(--text-muted); text-align: center; margin-top: 0.5rem;">
          Video alanının etrafındaki boşluğu ayarlar
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="form-group">
        <button class="btn btn-danger" onclick="clearAllVideos()" style="width: 100%;">
          <i class="fas fa-trash"></i>
          Tüm Videoları Temizle
        </button>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
        <button class="btn btn-secondary" onclick="exportSettings()">
          <i class="fas fa-download"></i>
          Dışa Aktar
        </button>
        <button class="btn btn-secondary" onclick="document.getElementById('importSettings').click()">
          <i class="fas fa-upload"></i>
          İçe Aktar
        </button>
      </div>

      <input type="file" id="importSettings" accept=".json" style="display: none;" onchange="importSettings(event)" />
    </div>
  </div>

  <!-- Main Content -->
  <div id="main">
    <!-- Empty State -->
    <div class="empty-state" id="emptyState">
      <h2>THE LENG'e Hoş Geldiniz</h2>
      <p>Çoklu video ve yayın izleme deneyiminizi başlatmak için ilk video/yayın bağlantınızı ekleyin.</p>
      <div class="empty-state-form">
        <input type="text" id="emptyVideoUrl" placeholder="YouTube veya Kick bağlantısını buraya yapıştırın..." />
        <button class="btn btn-primary" onclick="addFromEmpty()" style="padding: 1.25rem;">
          <i class="fas fa-play"></i>
          İlk Video/Yayını Ekle
        </button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let players = [];
    let videoInstances = new Map();
    let isFullscreen = false;
    let currentLayout = 'auto';
    const videoList = document.getElementById("videoList");
    const main = document.getElementById("main");
    const sidebar = document.getElementById("sidebar");
    const settings = document.getElementById("settings");
    const header = document.getElementById("header");
    const emptyState = document.getElementById("emptyState");
    const toggleSidebarBtn = document.getElementById("toggleSidebar");
    const toggleSettingsBtn = document.getElementById("toggleSettings");
    const toggleFullscreenBtn = document.getElementById("toggleFullscreen");
    const openPopupBtn = document.getElementById("openPopup");
    const marginSlider = document.getElementById("marginSlider");
    const videoCountDisplay = document.getElementById("videoCount");
    const totalVideosDisplay = document.getElementById("totalVideos");
    const playingVideosDisplay = document.getElementById("playingVideos");

    // Polyfill for crypto.randomUUID
    if (!crypto.randomUUID) {
      crypto.randomUUID = function() {
        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
      };
    }

    // Empty state management
    function updateEmptyState() {
      const hasVideos = videoInstances.size > 0;
      emptyState.style.display = hasVideos ? 'none' : 'block';
    }

    function addFromEmpty() {
      const url = document.getElementById("emptyVideoUrl").value.trim();
      const videoData = extractVideoID(url);
      
      if (videoData) {
        document.getElementById("emptyVideoUrl").value = "";
        addVideo(videoData);
      } else {
        showNotification("Geçersiz URL. YouTube veya Kick bağlantısı girin.", 'error');
      }
    }

    // Popup functionality
    function openPopup() {
      const currentUrl = window.location.href;
      const popupFeatures = 'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,copyhistory=no,width=' + screen.width + ',height=' + screen.height + ',top=0,left=0';
      
      const popup = window.open(currentUrl, 'TheLengPopup', popupFeatures);
      
      if (popup) {
        showNotification('Popup pencerede açıldı', 'success');
        popup.focus();
      } else {
        showNotification('Popup engellenmiş olabilir. Tarayıcı ayarlarını kontrol edin.', 'error');
      }
    }

    // Platform detection
    function detectPlatform(url) {
      if (url.includes('youtube.com') || url.includes('youtu.be')) {
        return 'youtube';
      } else if (url.includes('kick.com')) {
        return 'kick';
      }
      return 'unknown';
    }

    // Extract video/stream ID
    function extractVideoID(url) {
      const platform = detectPlatform(url);
      
      if (platform === 'youtube') {
        const regExp = /^.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return match && match[1].length === 11 ? { id: match[1], platform: 'youtube' } : null;
      } else if (platform === 'kick') {
        const regExp = /kick\.com\/([^\/\?]+)/;
        const match = url.match(regExp);
        return match ? { id: match[1], platform: 'kick' } : null;
      }
      
      return null;
    }

    // Template selection
    function selectTemplate(layout) {
      currentLayout = layout;
      
      // Update active template card
      document.querySelectorAll('.template-card').forEach(card => {
        card.classList.remove('active');
      });
      document.querySelector(`[data-layout="${layout}"]`).classList.add('active');
      
      // Apply layout
      updateGridLayout();
      localStorage.setItem("layout", layout);
      showNotification(`${getLayoutName(layout)} düzeni seçildi`, 'success');
    }

    function getLayoutName(layout) {
      const names = {
        'auto': 'Otomatik',
        'focus': 'Ana Odak',
        'pip': 'PiP Modu',
        'sidebar': 'Kenar Çubuğu'
      };
      return names[layout] || layout;
    }

    // Fullscreen functionality
    function toggleFullscreen() {
      if (!isFullscreen) {
        if (document.documentElement.requestFullscreen) {
          document.documentElement.requestFullscreen();
        } else if (document.documentElement.webkitRequestFullscreen) {
          document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) {
          document.documentElement.msRequestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
    }

    // Listen for fullscreen changes
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
    document.addEventListener('msfullscreenchange', handleFullscreenChange);

    function handleFullscreenChange() {
      isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);
      const icon = toggleFullscreenBtn.querySelector('i');
      
      if (isFullscreen) {
        icon.className = 'fas fa-compress';
        document.body.classList.add('fullscreen-active');
        showNotification('Tam ekran modu açıldı', 'success');
      } else {
        icon.className = 'fas fa-expand';
        document.body.classList.remove('fullscreen-active');
        showNotification('Tam ekran modu kapatıldı', 'success');
      }
    }

    // Panel management
    function toggleSidebar() {
      const isSidebarActive = sidebar.classList.contains("active");
      const isSettingsActive = settings.classList.contains("active");
      
      if (isSettingsActive) {
        settings.classList.remove("active");
      }
      
      sidebar.classList.toggle("active", !isSidebarActive);
      updateMainLayout();
      updateHeaderVisibility();
    }

    function toggleSettings() {
      const isSettingsActive = settings.classList.contains("active");
      const isSidebarActive = sidebar.classList.contains("active");
      
      if (isSidebarActive) {
        sidebar.classList.remove("active");
      }
      
      settings.classList.toggle("active", !isSettingsActive);
      updateMainLayout();
      updateHeaderVisibility();
    }

    function updateMainLayout() {
      const isSidebarActive = sidebar.classList.contains("active");
      const isSettingsActive = settings.classList.contains("active");
      
      main.classList.remove("sidebar-shifted", "settings-shifted", "both-shifted");
      
      if (isSidebarActive && isSettingsActive) {
        main.classList.add("both-shifted");
      } else if (isSidebarActive) {
        main.classList.add("sidebar-shifted");
      } else if (isSettingsActive) {
        main.classList.add("settings-shifted");
      }
    }

    function updateHeaderVisibility() {
      const isSidebarActive = sidebar.classList.contains("active");
      const isSettingsActive = settings.classList.contains("active");
      
      if (isSidebarActive || isSettingsActive) {
        header.classList.add("visible");
        main.classList.add("header-visible");
      } else {
        header.classList.remove("visible");
        main.classList.remove("header-visible");
      }
    }

    // Unified margin control
    function updateMargins() {
      const value = marginSlider.value;
      document.getElementById('marginValue').textContent = `${value}px`;
      
      main.style.padding = `${value}px`;
      localStorage.setItem("margins", value);
    }

    // Notification system
    function showNotification(message, type = 'info') {
      const div = document.createElement("div");
      div.className = `notification ${type}`;
      div.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 4500);
    }

    // Statistics update
    function updateStats() {
      const videoCount = main.querySelectorAll("iframe").length;
      const playingCount = players.filter(player => {
        try {
          return player.getPlayerState() === 1;
        } catch (e) {
          return false;
        }
      }).length;

      videoCountDisplay.textContent = `${videoCount} Video`;
      totalVideosDisplay.textContent = videoCount;
      playingVideosDisplay.textContent = playingCount;
    }

    // Grid layout management
    function updateGridLayout() {
      const videoCount = main.querySelectorAll("iframe").length;
      
      // Remove all layout classes
      main.classList.remove(
        "video-count-1", "video-count-2", "video-count-3", "video-count-4", 
        "video-count-5", "video-count-6", "video-count-7", "video-count-8", "video-count-9",
        "layout-1x2", "layout-2x2", "layout-2x3", "layout-focus", "layout-pip", "layout-sidebar"
      );
      
      if (currentLayout === "auto") {
        if (videoCount >= 1 && videoCount <= 9) {
          main.classList.add(`video-count-${videoCount}`);
        }
      } else {
        main.classList.add(`layout-${currentLayout}`);
      }
      
      updateStats();
      updateEmptyState();
    }

    // Video management
    async function getVideoInfo(videoData) {
      const { id, platform } = videoData;
      
      if (platform === 'youtube') {
        try {
          const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
          const data = await response.json();
          return {
            title: data.title || id,
            author: data.author_name || 'Bilinmeyen',
            thumbnail: data.thumbnail_url || `https://img.youtube.com/vi/${id}/default.jpg`,
            platform: 'youtube'
          };
        } catch (e) {
          console.error("YouTube video info fetch failed:", e);
          return {
            title: id,
            author: 'Bilinmeyen',
            thumbnail: `https://img.youtube.com/vi/${id}/default.jpg`,
            platform: 'youtube'
          };
        }
      } else if (platform === 'kick') {
        return {
          title: `${id} - Kick Yayını`,
          author: id,
          thumbnail: '/placeholder.svg?height=50&width=70',
          platform: 'kick'
        };
      }
      
      return null;
    }

    async function addVideo(videoData, instanceId = crypto.randomUUID()) {
      if (videoList.querySelectorAll(".video-item").length >= 9) {
        showNotification("Maksimum 9 video/yayın eklenebilir.", 'error');
        return;
      }

      const videoInfo = await getVideoInfo(videoData);
      if (!videoInfo) {
        showNotification("Video bilgileri alınamadı.", 'error');
        return;
      }

      let embedUrl;
      if (videoData.platform === 'youtube') {
        embedUrl = `https://www.youtube.com/embed/${videoData.id}?autoplay=0&enablejsapi=1`;
      } else if (videoData.platform === 'kick') {
        embedUrl = `https://player.kick.com/${videoData.id}`;
      }

      // Create video container
      const container = document.createElement("div");
      container.className = "video-container";
      container.dataset.videoId = videoData.id;
      container.dataset.instanceId = instanceId;
      container.dataset.platform = videoData.platform;

      // Create platform indicator
      const platformIndicator = document.createElement("div");
      platformIndicator.className = `platform-indicator platform-${videoData.platform}`;
      platformIndicator.textContent = videoData.platform.toUpperCase();

      // Create iframe
      const iframe = document.createElement("iframe");
      iframe.src = embedUrl;
      iframe.dataset.videoId = videoData.id;
      iframe.dataset.instanceId = instanceId;
      iframe.setAttribute("loading", "lazy");
      iframe.setAttribute("allowfullscreen", "true");
      
      if (videoData.platform === 'kick') {
        iframe.setAttribute("allow", "autoplay; fullscreen");
      }
      
      iframe.onload = () => {
        iframe.classList.add("loaded");
        if (videoData.platform === 'youtube') {
          try {
            const player = new YT.Player(iframe, {
              events: {
                'onStateChange': updateStats
              }
            });
            players.push(player);
          } catch (e) {
            console.error("Player creation failed:", e);
          }
        }
      };
      
      iframe.onerror = () => {
        showNotification("Video/yayın yüklenemedi.", 'error');
        container.remove();
      };

      // Create overlay
      const overlay = document.createElement("div");
      overlay.className = "video-overlay";
      overlay.innerHTML = `
        <div class="video-info">${videoInfo.title}</div>
        <div class="video-controls">
          <button class="btn btn-sm btn-danger" onclick="removeVideo('${instanceId}')">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;

      container.appendChild(platformIndicator);
      container.appendChild(iframe);
      container.appendChild(overlay);
      main.appendChild(container);

      // Create list item
      const listItem = document.createElement("div");
      listItem.className = "video-item";
      listItem.dataset.videoId = videoData.id;
      listItem.dataset.instanceId = instanceId;
      listItem.dataset.platform = videoData.platform;
      listItem.draggable = true;

      listItem.innerHTML = `
        <img class="video-thumbnail" src="${videoInfo.thumbnail}" alt="Video thumbnail" />
        <div class="video-details">
          <div class="video-title">${videoInfo.title}</div>
          <div class="video-duration">${videoInfo.author} • ${videoData.platform.toUpperCase()}</div>
        </div>
        <button class="btn btn-sm btn-danger" onclick="removeVideo('${instanceId}')">
          <i class="fas fa-trash"></i>
        </button>
      `;

      videoList.appendChild(listItem);
      videoInstances.set(instanceId, { videoData, listItem, container, videoInfo });
      
      saveVideos();
      makeDraggable();
      updateGridLayout();
      updateHash();
      showNotification(`"${videoInfo.title}" eklendi`, 'success');
    }

    function removeVideo(instanceId) {
      const instance = videoInstances.get(instanceId);
      if (instance) {
        instance.container.remove();
        instance.listItem.remove();
        players = players.filter(player => {
          try {
            return player.getIframe().dataset.instanceId !== instanceId;
          } catch (e) {
            return true;
          }
        });
        videoInstances.delete(instanceId);
        saveVideos();
        updateGridLayout();
        updateHash();
        showNotification("Video/yayın kaldırıldı", 'success');
      }
    }

    function clearAllVideos() {
      if (confirm('Tüm video/yayınları kaldırmak istediğinizden emin misiniz?')) {
        videoInstances.forEach((_, instanceId) => removeVideo(instanceId));
        showNotification('Tüm video/yayınlar kaldırıldı', 'success');
      }
    }

    // Playback controls (only for YouTube)
    function playAll() {
      players.forEach(player => {
        try {
          player.playVideo();
        } catch (e) {
          console.error("Play failed:", e);
        }
      });
      showNotification('YouTube videoları oynatılıyor', 'success');
    }

    function pauseAll() {
      players.forEach(player => {
        try {
          player.pauseVideo();
        } catch (e) {
          console.error("Pause failed:", e);
        }
      });
      showNotification('YouTube videoları duraklatıldı', 'success');
    }

    // Settings management
    function exportSettings() {
      const settings = {
        videos: Array.from(videoList.querySelectorAll(".video-item")).map(item => ({
          id: item.dataset.videoId,
          platform: item.dataset.platform
        })),
        layout: currentLayout,
        margins: marginSlider.value
      };
      
      const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'the-leng-settings.json';
      a.click();
      URL.revokeObjectURL(url);
      showNotification('Ayarlar dışa aktarıldı', 'success');
    }

    function importSettings(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const settings = JSON.parse(e.target.result);
            
            // Clear existing videos
            videoInstances.forEach((_, instanceId) => removeVideo(instanceId));
            
            // Import videos
            if (settings.videos) {
              settings.videos.forEach(videoData => {
                if (typeof videoData === 'string') {
                  // Old format compatibility
                  addVideo({ id: videoData, platform: 'youtube' });
                } else {
                  addVideo(videoData);
                }
              });
            }
            
            // Import other settings
            if (settings.layout) {
              selectTemplate(settings.layout);
            }
            
            if (settings.margins) {
              marginSlider.value = settings.margins;
              updateMargins();
            }
            
            showNotification('Ayarlar içe aktarıldı', 'success');
          } catch (error) {
            showNotification('Ayarlar dosyası geçersiz', 'error');
          }
        };
        reader.readAsText(file);
      }
    }

    // Drag and drop functionality
    function makeDraggable() {
      const items = videoList.querySelectorAll(".video-item");
      items.forEach(item => {
        item.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", item.dataset.instanceId);
          item.classList.add("dragging");
        });
        
        item.addEventListener("dragend", () => {
          item.classList.remove("dragging");
        });
        
        item.addEventListener("dragover", e => {
          e.preventDefault();
        });
        
        item.addEventListener("drop", e => {
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text");
          const draggedItem = videoList.querySelector(`[data-instance-id="${draggedId}"]`);
          const dropItem = item;
          
          if (draggedItem && dropItem && draggedItem !== dropItem) {
            const dropIndex = Array.from(videoList.children).indexOf(dropItem);
            const draggedIndex = Array.from(videoList.children).indexOf(draggedItem);
            
            if (dropIndex < draggedIndex) {
              videoList.insertBefore(draggedItem, dropItem);
            } else {
              videoList.insertBefore(draggedItem, dropItem.nextSibling);
            }
            
            saveVideos();
            updateHash();
            showNotification('Video sırası değiştirildi', 'success');
          }
        });
      });
    }

    // Storage functions
    function saveVideos() {
      const videos = Array.from(videoList.querySelectorAll(".video-item")).map(item => ({
        id: item.dataset.videoId,
        platform: item.dataset.platform
      }));
      localStorage.setItem("savedVideos", JSON.stringify(videos));
    }

    function updateHash() {
      const videos = Array.from(videoList.querySelectorAll(".video-item")).map(item => 
        `${item.dataset.platform}:${item.dataset.videoId}`
      );
      window.location.hash = videos.length ? `videos=${videos.join(",")}` : "";
    }

    function loadVideos() {
      const hash = window.location.hash;
      let videos = [];
      
      if (hash.startsWith("#videos=")) {
        const videoStrings = hash.substring(8).split(",");
        videos = videoStrings.map(videoString => {
          if (videoString.includes(':')) {
            const [platform, id] = videoString.split(':');
            return { id, platform };
          } else {
            // Old format compatibility
            return { id: videoString, platform: 'youtube' };
          }
        }).filter(video => video.id);
      } else {
        const savedVideos = JSON.parse(localStorage.getItem("savedVideos") || "[]");
        videos = savedVideos.map(video => {
          if (typeof video === 'string') {
            return { id: video, platform: 'youtube' };
          }
          return video;
        });
      }
      
      videos.forEach(videoData => addVideo(videoData));
      
      // Load layout
      const savedLayout = localStorage.getItem("layout") || "auto";
      selectTemplate(savedLayout);
      
      // Load margins
      const savedMargins = localStorage.getItem("margins") || "0";
      marginSlider.value = savedMargins;
      updateMargins();
    }

    // Debounced add video function
    function debounce(fn, ms) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), ms);
      };
    }

    const debouncedAddVideo = debounce(() => {
      const url = document.getElementById("videoUrl").value.trim();
      const videoData = extractVideoID(url);
      
      if (videoData) {
        document.getElementById("videoUrl").value = "";
        addVideo(videoData);
      } else {
        showNotification("Geçersiz URL. YouTube veya Kick bağlantısı girin.", 'error');
      }
    }, 300);

    // Event listeners
    function initializeEventListeners() {
      toggleSidebarBtn.addEventListener("click", toggleSidebar);
      toggleSettingsBtn.addEventListener("click", toggleSettings);
      toggleFullscreenBtn.addEventListener("click", toggleFullscreen);
      openPopupBtn.addEventListener("click", openPopup);
      marginSlider.addEventListener("input", updateMargins);

      // Keyboard shortcuts
      document.addEventListener("keydown", e => {
        if (e.ctrlKey && e.key === "Enter") {
          debouncedAddVideo();
        }
        if (e.key === "Escape") {
          if (sidebar.classList.contains("active")) toggleSidebar();
          if (settings.classList.contains("active")) toggleSettings();
        }
        if (e.key === "F11") {
          e.preventDefault();
          toggleFullscreen();
        }
      });

      // Close panels when clicking outside
      document.addEventListener("click", e => {
        if (!sidebar.contains(e.target) && !toggleSidebarBtn.contains(e.target) && sidebar.classList.contains("active")) {
          toggleSidebar();
        }
        if (!settings.contains(e.target) && !toggleSettingsBtn.contains(e.target) && settings.classList.contains("active")) {
          toggleSettings();
        }
      });

      // Enter key in URL inputs
      document.getElementById("videoUrl").addEventListener("keypress", e => {
        if (e.key === "Enter") {
          debouncedAddVideo();
        }
      });

      document.getElementById("emptyVideoUrl").addEventListener("keypress", e => {
        if (e.key === "Enter") {
          addFromEmpty();
        }
      });
    }

    // YouTube API ready callback
    window.onYouTubeIframeAPIReady = function() {
      console.log("YouTube Iframe API loaded");
      initializeEventListeners();
      loadVideos();
      updateStats();
      updateEmptyState();
      showNotification("THE LENG hazır!", 'success');
    };

    // Load YouTube Iframe API
    (function() {
      const script = document.createElement("script");
      script.src = "https://www.youtube.com/iframe_api";
      script.onerror = () => {
        console.error("YouTube Iframe API failed to load");
        showNotification("YouTube API yüklenemedi. İnternet bağlantınızı kontrol edin.", 'error');
        // Initialize without YouTube API for Kick streams
        initializeEventListeners();
        loadVideos();
        updateStats();
        updateEmptyState();
        showNotification("THE LENG hazır! (Sadece Kick desteği)", 'success');
      };
      document.head.appendChild(script);
    })();

    // Update stats periodically
    setInterval(updateStats, 5000);
  </script>
</body>
</html>